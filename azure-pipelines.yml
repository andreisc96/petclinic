# The below pipeline is designed to build the .jar for petclinic app
# https://aka.ms/yaml

trigger:
- main

pool:
  name: Default

stages:
  - stage: Build
    jobs:
    - job: BuildJob
      steps:
      - task: Maven@4
        inputs:
          #azureSubscription: 'Azure subscription 1(0fa225b2-6ae6-47ee-931c-b34ef669c09c)'
          mavenPomFile: 'pom.xml'
          goals: 'package'
      - publish: 'target/spring-petclinic-3.5.0-SNAPSHOT.jar'
        artifact: 'drop'

  - stage: Deploy
    dependsOn: Build 
    jobs:
    - job: DeployJob
      steps:
       - download: current
         artifact: drop
       - script: ansible-playbook -i inventories/inventory.ini /home/osansible/ansibleconfig/main_playbook.yml
         displayName: 'Deploying app with Ansible'    

